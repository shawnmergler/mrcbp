export type SM2State = { repetition: number; interval: number; ef: number; }; export function updateSM2(prev: SM2State, quality: 0|1|2|3|4|5): SM2State { let { repetition, interval, ef } = prev; if (quality < 3) { repetition = 0; interval = 1; } else { if (repetition === 0) interval = 1; else if (repetition === 1) interval = 6; else interval = Math.round(interval * ef); repetition += 1; } ef = ef + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)); if (ef < 1.3) ef = 1.3; return { repetition, interval, ef }; } export function nextDueDate(days: number): Date { const d = new Date(); d.setUTCDate(d.getUTCDate() + Math.max(1, days)); return d; }
