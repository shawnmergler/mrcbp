import { prisma } from '@/lib/prisma'; export default async function AdminPage(){ const divisions = await prisma.division.findMany({ orderBy: { csiCode: 'asc' } }); const lessons = await prisma.lesson.findMany({ include: { division: true, role: true }, orderBy: { id: 'desc' } }); const roles = await prisma.role.findMany({ orderBy: { system: 'asc' } }); return (<div className='space-y-6'><div className='card'><h1 className='text-2xl font-bold'>Admin — Authoring</h1><p className='text-gray-600'>Create lessons and add exercises. (Basic demo authoring UI.)</p></div><div className='card'><h2 className='text-lg font-semibold mb-3'>Create Lesson</h2><form action='/api/admin/lesson' method='post' className='grid grid-cols-1 sm:grid-cols-2 gap-3'><div><label className='label'>Title</label><input name='title' className='input' required /></div><div><label className='label'>Training System</label><select name='system' className='select' required><option value='PROJECT_MANAGEMENT'>Project Management</option><option value='SITE_SUPERVISION'>Site Supervision</option></select></div><div><label className='label'>Division</label><select name='divisionId' className='select' required>{divisions.map(d=><option key={d.id} value={d.id}>Div {String(d.csiCode).padStart(2,'0')} — {d.name}</option>)}</select></div><div><label className='label'>Role (optional)</label><select name='roleId' className='select'><option value=''>— None —</option>{roles.map(r=><option key={r.id} value={r.id}>{r.system} — {r.level}. {r.name}</option>)}</select></div><div className='sm:col-span-2'><label className='label'>Description</label><textarea name='description' className='input' rows={3}></textarea></div><div className='sm:col-span-2'><button className='btn btn-primary' formMethod='post'>Create Lesson</button></div></form></div><div className='card'><h2 className='text-lg font-semibold mb-3'>Recent Lessons</h2><table className='table'><thead><tr><th>ID</th><th>Title</th><th>System</th><th>Role</th><th>Division</th><th>Exercises</th></tr></thead><tbody>{lessons.map(l=>(<tr key={l.id}><td>{l.id}</td><td>{l.title}</td><td>{l.system}</td><td>{l.role ? `${l.role.level}. ${l.role.name}` : '—'}</td><td>{`Div ${String(l.division.csiCode).padStart(2,'0')} — ${l.division.name}`}</td><td><a className='text-blue-600 underline' href={`/admin/lesson/${l.id}`}>Manage</a></td></tr>))}</tbody></table></div></div>); }
